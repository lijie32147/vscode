<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.bootcdn.net/ajax/libs/vue/2.6.11/vue.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/axios/0.19.2/axios.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/layer/3.1.1/layer.min.js"></script>
    <link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" rel="stylesheet"> 
    <title>Document</title>
</head>
<body>
    
    <div id="app">
        <form method="POST">
            uname: <input type="text" v-model="uname"> <br>
            birthday: <input type="text" v-model="birthday"> <br>
            <button @click="save" type="button">添加用户</button>
        </form>

        <table class="table">
            <tr v-for="item in list">
                <td>{{item.uid}}</td>
                <td>{{item.uname}}</td>
                <td>{{item.birthday|dateFormat}}</td>
                <td>
                    <button class="btn btn-primary" @click="del(item.uid)">删除</button>
                    <button class="btn btn-primary" @click="updateUI(item)">修改</button>
                </td>
            </tr>
        </table>

        <div id="d1" style="display: none;">
            <form method="POST">
                <input type="hidden" v-model="uid2"> <br>
                uname: <input type="text" v-model="uname2"> <br>
                birthday: <input type="text" v-model="birthday2"> <br>
                <button @click="update" type="button">修改用户</button>
            </form>
        </div>
    </div>

    <script>

        var app = new Vue({

            el: "#app",

            data: {
                uname: "",
                birthday: "",

                uid2: "",
                uname2: "",
                birthday2: "",

                layerDiv: null,

                list: null
            },

            // 组件加载完，在页面显示之后执行
            mounted(){
                axios.defaults.baseURL = "http://localhost:8080";
                this.updateTable();
            },

            //过滤器
            filters: {
                "dateFormat": function(value){
                    if(value == null){
                        return "";
                    }
                    return value.substring(0,value.indexOf('T'));
                }
            },

            methods: {
                save(){
                    var self = this;
                    axios.post("/users/save",{
                        uname: self.uname,
                        birthday: self.birthday
                    }).then(function(){
                        layer.msg('添加成功！！！');
                        self.uname = self.birthday = "";
                        self.updateTable();
                    });
                },

                update(){
                    var self = this;
                    axios.post("/users/update",{
                        uid: self.uid2,
                        uname: self.uname2,
                        birthday: self.birthday2,
                    }).then(function(){
                        layer.msg('修改成功！！！');
                        self.uname2 = self.birthday2 = "";
                        self.updateTable();
                        layer.close(self.layerDiv);
                    });
                },

                updateTable(){
                    axios.post("/users/findAll").then(function(response){
                        app.list = response.data;
                    });
                },

                del(uid){

                    layer.confirm('确认删除？？？', {
                        btn: ['确认','点错了'] //按钮
                    }, function(){
                        axios.post("/users/delete",{"uid":uid}).then(function(){
                        layer.msg("删除成功！！！");
                        app.updateTable();
                    });
                    }, function(){
                        //..........
                    }); 
                },

                updateUI(item){

                    this.uid2 = item.uid;
                    this.uname2 = item.uname;
                    
                    var str = item.birthday.substring(0,item.birthday.indexOf('T'));
                    this.birthday2 = str;

                    this.layerDiv = layer.open({
                        type: 1,
                        skin: 'layui-layer-rim', //加上边框
                        area: ['420px', '240px'], //宽高
                        content: $('#d1')
                    });
                }
            }
        });
    </script>

</body>
</html>